# 離床事件預測系統

此系統使用CNN-LSTM深度學習模型預測離床事件，可根據床載數據提前預警。

## 系統架構

系統已按照軟體工程原則進行模組化設計，分為以下幾個主要模組：

1. **配置模組 (config.py)**
   - 包含所有全域常數設定
   - 數據路徑、模型參數等配置

2. **工具模組 (utils.py)**
   - 包含字型設定和通用功能函數
   - 處理檔案路徑、保存處理後序列等

3. **數據處理模組 (data_processing.py)**
   - 負責原始數據的載入、清理和預處理
   - 生成序列資料用於訓練和預測

4. **自訂損失函數模組 (custom_losses.py)**
   - 實作多種基於時間的客製化損失函數
   - 提高模型對離床事件的時間預測精確度

5. **模型定義模組 (model.py)**
   - CNN-LSTM模型架構
   - 自訂評估回調函數

6. **評估模組 (evaluation.py)**
   - 提供多種評估指標和視覺化方法
   - 生成評估報告和圖表

7. **主模組 (main.py)**
   - 整合所有功能，提供命令列介面
   - 處理程式執行流程

8. **初始化模組 (__init__.py)**
   - 模組初始化和導入配置

## 模組化重構

系統重構過程如下：

1. **模組分離**：將原始的單一檔案拆分為多個功能明確的模組，確保每個模組只負責特定功能
2. **依賴關係整理**：修正模組間的導入路徑，確保所有模組能正確引用其他模組
3. **命名標準化**：使用一致的命名規範，提高程式碼可讀性
4. **錯誤處理增強**：增加適當的錯誤處理和日誌記錄
5. **中文支援優化**：確保所有視覺化輸出正確顯示中文字符

重構後的系統具有以下優點：
- 提高程式碼的可讀性和可維護性
- 分離不同功能的關注點
- 更易於進行單元測試和功能擴展
- 簡化團隊協作和代碼審查流程

## 使用方法

### 安裝依賴
```bash
pip install tensorflow pandas numpy matplotlib scikit-learn
```

### 訓練新模型
```bash
python -m model.main
```

### 只進行預測（不訓練）
```bash
python -m model.main --load-only
```

### 設定閾值
```bash
python -m model.main --threshold 0.5
```

### 使用自訂數據路徑
```bash
python -m model.main --input-data /path/to/your/data.csv
```

### 預測新資料（使用現有模型）
```bash
python -m model.main --predict-new --input-data /path/to/your/new_data.csv
```

## 模型結果分析

系統會生成多種圖表和報告來評估模型表現，包括：

1. 事件時間軸圖：顯示真實事件和預測事件的時間分布
2. 時間差異分布圖：分析預測提前時間與目標時間的差異
3. 預測準確率趨勢圖：顯示準確率隨時間的變化
4. 綜合評估報告：包含各項重要指標（檢測率、誤報率、提前時間等）

所有輸出結果預設保存在 `_logs/bed_monitor_test_sum` 目錄下 